<?php

/** @var \News\Manger\Block\User\News\View $block */
$news = $block->getNews();
$newsInfo = $block->getDetailedNewsInfo();
$sharingLinks = $block->getSharingLinks();
$categoryPaths = $block->getDetailedCategoryPathsForCurrentNews();
?>

<?php if ($news): ?>
  <div class="news-view-container">
    <!-- عنوان الخبر -->
    <h1 class="news-view-title"><?= $block->escapeHtml($newsInfo['title']) ?></h1>

    <!-- معلومات أساسية -->
    <div class="news-view-meta">
      <div class="meta-item">
        <i class="icon-calendar"></i>
        <span><?= $block->escapeHtml(__('Published on: %1', $block->formatArabicDate($newsInfo['created_at']))) ?></span>
      </div>

      <?php if ($newsInfo['author_name']): ?>
        <div class="meta-item">
          <i class="icon-user"></i>
          <span><?= $block->escapeHtml(__('Author: %1', $newsInfo['author_name'])) ?></span>
        </div>
      <?php endif; ?>

      <div class="meta-item">
        <i class="icon-eye"></i>
        <span><?= $block->escapeHtml(__('Views: %1', number_format($newsInfo['view_count']))) ?></span>
      </div>

      <?php if ($newsInfo['is_featured']): ?>
        <div class="meta-item featured-badge">
          <i class="icon-star"></i>
          <span><?= $block->escapeHtml(__('Featured')) ?></span>
        </div>
      <?php endif; ?>
    </div>

    <!-- التسلسل الهرمي للفئات -->
    <?php if (!empty($categoryPaths)): ?>
      <div class="news-view-categories">
        <h3><?= $block->escapeHtml(__('Categories')) ?></h3>
        <div class="category-tags">
          <?php foreach ($categoryPaths as $pathData): ?>
            <a href="<?= $block->escapeUrl($pathData['url']) ?>" class="category-tag">
              <?= $block->escapeHtml($pathData['name']) ?>
            </a>
          <?php endforeach; ?>
        </div>
      </div>
    <?php else: ?>
      <div class="news-view-categories">
        <h3><?= $block->escapeHtml(__('Categories')) ?></h3>
        <p><?= $block->escapeHtml(__('No Categories Assigned')) ?></p>
      </div>
    <?php endif; ?>

    <!-- الصورة المميزة -->
    <?php if ($newsInfo['featured_image']): ?>
      <div class="featured-image-container">
        <img src="<?= $block->escapeUrl($newsInfo['featured_image']) ?>"
          alt="<?= $block->escapeHtml($newsInfo['title']) ?>"
          class="featured-image">
      </div>
    <?php endif; ?>

    <!-- المقتطف إذا كان متاحاً -->
    <?php if ($newsInfo['excerpt']): ?>
      <div class="news-excerpt">
        <h4><?= $block->escapeHtml(__('Summary')) ?></h4>
        <p><?= $block->escapeHtml($newsInfo['excerpt']) ?></p>
      </div>
    <?php endif; ?>

    <!-- محتوى الخبر -->
    <div class="news-view-content">
      <?= $newsInfo['content'] ?>
    </div>

    <!-- معلومات إضافية -->
    <div class="additional-info">
      <div class="info-section">
        <h4><?= $block->escapeHtml(__('News Details')) ?></h4>
        <table class="info-table">
          <tr>
            <td><?= $block->escapeHtml(__('News ID')) ?></td>
            <td>#<?= $block->escapeHtml($newsInfo['id']) ?></td>
          </tr>
          <tr>
            <td><?= $block->escapeHtml(__('Status')) ?></td>
            <td>
              <span class="status-badge <?= $newsInfo['status'] ? 'active' : 'inactive' ?>">
                <?= $newsInfo['status'] ? __('active') : __('Draft') ?>
              </span>
            </td>
          </tr>
          <?php if ($newsInfo['publish_date'] != $newsInfo['created_at']): ?>
            <tr>
              <td><?= $block->escapeHtml(__('Publish Date')) ?></td>
              <td><?= $block->escapeHtml($block->formatArabicDate($newsInfo['publish_date'])) ?></td>
            </tr>
          <?php endif; ?>
          <?php if ($newsInfo['updated_at'] != $newsInfo['created_at']): ?>
            <tr>
              <td><?= $block->escapeHtml(__('Last Updated')) ?></td>
              <td><?= $block->escapeHtml($block->formatArabicDate($newsInfo['updated_at'])) ?></td>
            </tr>
          <?php endif; ?>
          <?php if ($newsInfo['slug']): ?>
            <tr>
              <td><?= $block->escapeHtml(__('URL Slug')) ?></td>
              <td><?= $block->escapeHtml($newsInfo['slug']) ?></td>
            </tr>
          <?php endif; ?>
        </table>
      </div>

      <!-- SEO Info -->
      <?php if ($newsInfo['meta_description'] || $newsInfo['meta_keywords']): ?>
        <div class="info-section">
          <h4><?= $block->escapeHtml(__('SEO Information')) ?></h4>
          <?php if ($newsInfo['meta_description']): ?>
            <div class="meta-field">
              <strong><?= $block->escapeHtml(__('Meta Description:')) ?></strong>
              <p><?= $block->escapeHtml($newsInfo['meta_description']) ?></p>
            </div>
          <?php endif; ?>
          <?php if ($newsInfo['meta_keywords']): ?>
            <div class="meta-field">
              <strong><?= $block->escapeHtml(__('Meta Keywords:')) ?></strong>
              <p><?= $block->escapeHtml($newsInfo['meta_keywords']) ?></p>
            </div>
          <?php endif; ?>
        </div>
      <?php endif; ?>
    </div>

    <!-- روابط المشاركة -->
    <div class="sharing-section">
      <h4><?= $block->escapeHtml(__('Share this news')) ?></h4>
      <div class="sharing-buttons">
        <a href="<?= $sharingLinks['facebook'] ?>" target="_blank" class="share-btn facebook">
          <i class="fab fa-facebook-f"></i> Facebook
        </a>
        <a href="<?= $sharingLinks['twitter'] ?>" target="_blank" class="share-btn twitter">
          <i class="fab fa-twitter"></i> Twitter
        </a>
        <a href="<?= $sharingLinks['linkedin'] ?>" target="_blank" class="share-btn linkedin">
          <i class="fab fa-linkedin-in"></i> LinkedIn
        </a>
        <a href="<?= $sharingLinks['whatsapp'] ?>" target="_blank" class="share-btn whatsapp">
          <i class="fab fa-whatsapp"></i> WhatsApp
        </a>
        <a href="<?= $sharingLinks['telegram'] ?>" target="_blank" class="share-btn telegram">
          <i class="fab fa-telegram-plane"></i> Telegram
        </a>
      </div>
    </div>

    <!-- الأخبار ذات الصلة -->
    <?php $relatedNews = $block->getRelatedNews(4); ?>
    <?php if (!empty($relatedNews)): ?>
      <div class="related-news-section">
        <h3><?= $block->escapeHtml(__('Related News')) ?></h3>
        <div class="related-news-grid">
          <?php foreach ($relatedNews as $related): ?>
            <div class="related-news-item">
              <?php if ($related['featured_image']): ?>
                <img src="<?= $block->escapeUrl($related['featured_image']) ?>"
                  alt="<?= $block->escapeHtml($related['news_title']) ?>"
                  class="related-news-image">
              <?php endif; ?>
              <div class="related-news-content">
                <h5>
                  <a href="<?= $block->getUrl('newsuser/user/view', ['id' => $related['id']]) ?>">
                    <?= $block->escapeHtml($related['news_title']) ?>
                  </a>
                </h5>
                <?php if ($related['excerpt']): ?>
                  <p><?= $block->escapeHtml(substr($related['excerpt'], 0, 100)) ?>...</p>
                <?php endif; ?>
                <span class="related-date"><?= $block->formatArabicDate($related['created_at']) ?></span>
              </div>
            </div>
          <?php endforeach; ?>
        </div>
      </div>
    <?php endif; ?>

    <!-- رابط العودة -->
    <div class="back-link-container">
      <a href="<?= $block->escapeUrl($block->getUrl('newsuser/user')) ?>" class="back-link">
        ← <?= $block->escapeHtml(__('Back to News List')) ?>
      </a>
    </div>
  </div>

  <style>
    .news-view-container {
      max-width: 900px;
      margin: 20px auto;
      padding: 30px;
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .news-view-title {
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: #2c3e50;
      line-height: 1.3;
      text-align: center;
    }

    .news-view-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid #ecf0f1;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9rem;
      color: #7f8c8d;
    }

    .featured-badge {
      background: linear-gradient(45deg, #f39c12, #e67e22);
      color: white;
      padding: 5px 12px;
      border-radius: 15px;
      font-weight: bold;
    }

    .news-view-categories {
      margin-bottom: 25px;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #3498db;
    }

    .category-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    .category-tag {
      display: inline-block;
      background: #3498db;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      text-decoration: none;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }

    .category-tag:hover {
      background-color: #2980b9;
    }

    .featured-image-container {
      text-align: center;
      margin-bottom: 25px;
    }

    .featured-image {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .news-excerpt {
      background: #e8f6f3;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 25px;
      border-left: 4px solid #16a085;
    }

    .news-view-content {
      margin: 30px 0;
      line-height: 1.8;
      font-size: 1.1rem;
      color: #2c3e50;
    }

    .additional-info {
      margin: 30px 0;
    }

    .info-section {
      background: #fdfdfd;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #ecf0f1;
    }

    .info-table {
      width: 100%;
      border-collapse: collapse;
    }

    .info-table td {
      padding: 10px;
      border-bottom: 1px solid #ecf0f1;
    }

    .info-table td:first-child {
      font-weight: bold;
      color: #34495e;
      width: 30%;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: bold;
      text-transform: uppercase;
    }

    .status-badge.active {
      background: #d4edda;
      color: #155724;
    }

    .status-badge.inactive {
      background: #f8d7da;
      color: #721c24;
    }

    .sharing-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      margin: 25px 0;
    }

    .sharing-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .share-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 15px;
      border-radius: 25px;
      text-decoration: none;
      color: white;
      font-weight: 500;
      transition: transform 0.2s, opacity 0.2s;
    }

    .share-btn:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .share-btn.facebook {
      background: #3b5998;
    }

    .share-btn.twitter {
      background: #1da1f2;
    }

    .share-btn.linkedin {
      background: #0077b5;
    }

    .share-btn.whatsapp {
      background: #25d366;
    }

    .share-btn.telegram {
      background: #0088cc;
    }

    .related-news-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid #ecf0f1;
    }

    .related-news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .related-news-item {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s;
    }

    .related-news-item:hover {
      transform: translateY(-5px);
    }

    .related-news-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .related-news-content {
      padding: 15px;
    }

    .related-news-content h5 {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: #2c3e50;
    }

    .related-news-content h5 a {
      color: #2980b9;
      text-decoration: none;
    }

    .related-news-content h5 a:hover {
      text-decoration: underline;
    }

    .related-news-content p {
      font-size: 0.9rem;
      color: #7f8c8d;
      margin-bottom: 8px;
    }

    .related-date {
      font-size: 0.8rem;
      color: #95a5a6;
    }

    .back-link-container {
      text-align: center;
      margin-top: 40px;
    }

    .back-link {
      display: inline-block;
      background: #3498db;
      color: #fff;
      padding: 10px 20px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 500;
      transition: background-color 0.3s;
    }

    .back-link:hover {
      background-color: #2980b9;
    }
  </style>
<?php else: ?>
  <div class="news-not-found">
    <h2><?= $block->escapeHtml(__('News Not Found')) ?></h2>
    <p><?= $block->escapeHtml(__('Sorry, the news article you are looking for could not be found.')) ?></p>
    <a href="<?= $block->escapeUrl($block->getBackUrl()) ?>" class="back-link">
      ← <?= $block->escapeHtml(__('Back to News List')) ?>
    </a>
  </div>

  <style>
    .news-not-found {
      max-width: 600px;
      margin: 50px auto;
      padding: 40px;
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      text-align: center;
    }

    .news-not-found h2 {
      color: #e74c3c;
      font-size: 2rem;
      margin-bottom: 15px;
    }

    .news-not-found p {
      color: #7f8c8d;
      font-size: 1rem;
      margin-bottom: 25px;
    }
  </style>
<?php endif; ?>
